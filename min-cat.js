let meow=null;!function(){const t="cat-animate",i=document.createElement("canvas");i.setAttribute("id",t),i.style.width="100dvw",i.style.height="100dvh",i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.backgroundColor="lightyellow",i.style.zIndex="999",document.body.appendChild(i);const e=document.getElementById(t),s=e.getContext("2d"),n={queue:0,mouse:{x:null,y:null},speedX:2,speedY:5,gravity:1,fraction:.7,rectangles:[],rectanglesCollisionDistance:300,direction:1,frameSpeed:1,canvas:{w:window.innerWidth,h:window.innerHeight},magicNumber:1,logs:{},debug:!1};function h(){e.width=window.innerWidth,e.height=window.innerHeight,n.canvas.w=window.innerWidth,n.canvas.h=window.innerHeight}function a(){n.frameSpeed>100?n.frameSpeed=1:n.frameSpeed++}function o(t,i,e,n=16,h){s.save(),s.font=`${n}px Arial`,s.textAlign=h,s.fillText(t,i,e),s.restore()}window.addEventListener("DOMContentLoaded",h),window.addEventListener("resize",h),e.addEventListener("mousemove",(t=>{n.mouse.x=t.x,n.mouse.y=t.y,n.direction=t.movementX>0?1:-1}));const r=function(t){return new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2,roundingMode:"trunc"}).format(t)};function c(t,i,e,h,a){this.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var i=16*Math.random()|0;return("x"==t?i:3&i|8).toString(16)})),this.name=t,this.width=h,this.height=a,this.x=i-this.width/2,this.y=e-this.height/2,this.originX=i,this.originY=e,this.speedX=n.speedX,this.speedY=n.speedY,this.direction=n.direction,this.collisionFound=!1,this.attackActionFound=!1,this.dx=this.speedX*this.direction,this.dy=this.speedY,this.spawnY=20,this.instance=null,this.setInstance=t=>{this.instance=t},this.update=function(){this.physic(),this.boundary(),this.updateOrigin(),this.move()},this.draw=function(){this.instance&&this.instance.animate(this.width,this.height,this.x,this.y,this.dx,this.name,this.collisionFound),n.debug&&this.rectangleDebug()},this.move=function(){"running"===this.instance.currentState&&((this.x+this.width>=n.canvas.w||this.x<=0)&&(this.dx=-this.dx),this.x+this.width>n.canvas.w&&(this.x=n.canvas.w-this.width),this.x+=this.dx)},this.actionCollision=function(){this.attackActionFound=!1},this.physic=function(){this.y+this.height>n.canvas.h?this.dy=parseInt(-this.dy*n.fraction)-.5:this.dy+=n.gravity,this.y<=0&&(this.dy=-this.dy),this.y+=this.dy;let t=.1;this.collisionFound&&this.dx>0&&(this.dx+=this.dx>=5?0:t),!this.collisionFound&&this.dx>0&&(this.dx+=this.dx>n.speedX?-.1:0),this.collisionFound&&this.dx<0&&(this.dx+=this.dx<=-5?0:-.1),!this.collisionFound&&this.dx<0&&(this.dx+=this.dx<-n.speedX?t:0)},this.updateOrigin=function(){this.originX=this.x+this.width/2,this.originY=this.y+this.height/2},this.boundary=function(){let t=2*Math.random()-1>0?n.speedX:-n.speedX,i=Math.random()*n.canvas.w-this.width;(this.y>n.canvas.h||this.x>n.canvas.w)&&(this.x=i-this.width<0?this.width:i,this.y=this.spawnY,this.dx=t)},this.collision=function(){if("running"!==this.instance.currentState)return;const t=[];n.rectangles.forEach((i=>{if(this.id!==i.id){let e=this.originX-i.originX,s=this.originY-i.originY,h=Math.sqrt(Math.pow(e,2)+Math.pow(s,2));h=Math.floor(h),t.push(h),n.debug&&h<=n.rectanglesCollisionDistance&&this.collisionDistanceDebug(i.originX,i.originY)}})),this.collisionFound=t.some((t=>t<=n.rectanglesCollisionDistance))},this.remove=function(){n.logs[this.id]=null},this.collisionDistanceDebug=function(t,i){s.save(),s.beginPath(),s.lineWidth=.5,s.moveTo(this.originX,this.originY),s.lineTo(t,i),s.stroke(),s.restore()},this.rectangleDebug=function(){let t="";var i,e;t+=`x: ${r(this.x)}`,t+=`, y: ${r(this.y)}`,t+=`, dx: ${r(this.dx)}`,t+=`, ox: ${r(this.originX)}`,t+=`, oy: ${r(this.originY)}`,t+=", collision: "+(this.collisionFound?"found":"not found"),t+=`, frame: ${this.instance.frame}`,t+=`, n: ${this.name}`,i=t,e=this.id,n.logs[e]=i,s.save(),s.strokeStyle="black",s.strokeRect(this.x,this.y,this.width,this.height),s.restore(),s.save(),s.fillStyle="green",s.beginPath(),s.arc(this.x,this.y,4,0,2*Math.PI),s.fill(),s.restore(),s.save(),s.fillStyle="red",s.beginPath(),s.arc(this.originX,this.originY,4,0,2*Math.PI),s.fill(),s.restore(),s.save(),s.fillStyle="blue",o(this.name,this.originX,this.originY-this.height/2-10,14,"center"),s.restore()}}function d(t){this.frame=0,this.spriteWidth=0,this.spriteHeight=0,this.width=this.spriteWidth,this.height=this.spriteHeight,this.runningImage=new Image,this.runningImage.src=t[0][0],this.idelImage=new Image,this.idelImage.src=t[1][0],this.attackImage=new Image,this.attackImage.src=t[2][0],this.steps=0,this.states=["running","idel","attack"],this.currentState="running",this.stateChangeCycle=100,this.runningImage.onerror=t=>{console.log(t)},this.idelImage.onerror=t=>{console.log(t)},this.attackImage.onerror=t=>{console.log(t)},this.animate=(t,i,e,s,n,h,a)=>{this.update(a),this.draw(e,s,n,h),this.setFrame(t,i)},this.update=function(i){if(n.frameSpeed%6==0){const e=t?.at(this.states.indexOf(this.currentState))?.at(1);if(this.frame>=e-1&&(this.frame=-1),this.steps===this.stateChangeCycle){let t=Math.floor(Math.random()*this.states.length),e=this.states.at(t);i||"attack"!==e||(e="idel"),this.currentState=e,this.steps=0}this.frame++,this.steps++}},this.setFrame=function(t,i){this.spriteWidth=t,this.spriteHeight=i,this.width=this.spriteWidth,this.height=this.spriteHeight},this.draw=function(t,i,e,n){let h=null,a=this.frame*this.spriteWidth;"running"===this.currentState?h=this.runningImage:"idel"===this.currentState?h=this.idelImage:"attack"===this.currentState&&(h=this.attackImage),e<0?(s.save(),s.scale(-1,1),s.drawImage(h,a,0,this.spriteWidth,this.spriteHeight,-t-this.width,i,this.width,this.height),s.restore()):(s.save(),s.drawImage(h,a,0,this.spriteWidth,this.spriteHeight,t,i,this.width,this.height),s.restore())}}function a(){n.frameSpeed++}e.addEventListener("click",(t=>{let i=130;n.mouse.x+i>=n.canvas.w&&(n.mouse.x=n.canvas.w-i),n.mouse.x-i<=0&&(n.mouse.x=i),n.mouse.y+59>=n.canvas.h&&(n.mouse.y=n.canvas.h-59),n.mouse.y-59<=0&&(n.mouse.y=59);const e=new c(`Rectangle ${n.magicNumber}`,n.mouse.x,n.mouse.y,130,59);0===n.queue&&e.setInstance(new d([[black_cat_run_sprite,10],[black_cat_idel_sprite,8],[black_cat_swipe_sprite,9]])),1===n.queue&&e.setInstance(new d([[brown_cat_run_sprite,9],[brown_cat_idel_sprite,8],[brown_cat_swipe_sprite,9]])),2===n.queue&&e.setInstance(new d([[grey_cat_run_sprite,9],[grey_cat_idel_sprite,8],[grey_cat_swipe_sprite,9]])),3===n.queue&&e.setInstance(new d([[lightbrown_cat_run_sprite,9],[lightbrown_cat_idel_sprite,8],[lightbrown_cat_swipe_sprite,9]])),4===n.queue&&e.setInstance(new d([[white_cat_run_sprite,9],[white_cat_idel_sprite,8],[white_cat_swipe_sprite,9]])),n.queue>=4?n.queue=0:n.queue++,n.rectangles.push(e),n.magicNumber++}));let l=null;function u(){s.clearRect(0,0,e.width,e.height),n.debug&&[`Mouse: (x: ${n.mouse.x}, y:${n.mouse.y})`,`Speed: (x:${n.speedX}, y:${n.speedY})`,`Gravity: ${n.gravity}`,`Fraction: ${n.fraction}`,`Cats: ${n.rectangles.length}`,`Direction: ${n.direction}`,`Frame Speed: ${n.frameSpeed}`,"Debug: "+(n.debug?"on":"off")].forEach(((t,i)=>{o(t,20,20+20*i,14,"left")})),n.debug&&function(){let t={};Object.keys(n.logs).forEach((i=>{null!==n.logs[i]&&(t[i]=n.logs[i])})),n.logs=t,Object.keys(n.logs).forEach(((t,i)=>{const s=n.logs[t];s&&o(s,e.width-20,20+20*i,14,"right")}))}(),a(),n.rectangles.forEach((t=>{t.update(),t.draw(),t.collision()})),l=requestAnimationFrame(u)}function g(){null!==l&&(cancelAnimationFrame(l),l=null)}function m(){g(),n.debug=!1,u()}m(),meow={gs:n,startCanvasAnimationFrame:m,cancelCanvasAnimationFrame:g,startDebugCansvasAnimationFrame:function(){g(),n.debug=!0,u()}}}();